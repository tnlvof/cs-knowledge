# Feature Specification: MeAIple Story - CS Quiz RPG

**Feature Branch**: `001-cs-quiz-rpg`
**Created**: 2026-02-13
**Status**: Draft
**Input**: PRD.md - 메AI플스토리: IT 서비스 운영 CS 지식 퀴즈 RPG

## Overview

AI 시대에 바이브코딩으로 프로젝트를 빠르게 만들 수 있지만, 실제 서비스 운영에는 탄탄한 CS 지식이 필수다. 게이미피케이션(RPG 세계관 + 캐릭터 성장)을 통해 자연스럽게 CS 지식을 체화할 수 있는 주관식 퀴즈 RPG 서비스.

**Target Users:**
- 바이브코딩으로 프로젝트는 만들 수 있지만 CS 기초가 부족한 개발자
- IT 서비스 운영 역량을 키우고 싶은 주니어~미드 레벨 개발자
- 기술 면접 준비생

**Core Value Proposition:**
- 게임처럼 공부: RPG 세계관 + 캐릭터 성장으로 학습 동기 극대화
- 주관식으로 진짜 실력: 객관식이 아닌 주관식 답변 → AI 채점으로 이해도 측정
- 레벨 1~100: 입문부터 CTO급까지 체계적 성장 경로

## Clarifications

### Session 2026-02-13

- Q: 동시 접속자 수 목표는? → A: MVP 기준 100명 이하 (Vercel 기본 + Supabase Free 플랜)
- Q: Gemini API rate limit 도달 시 폴백 전략은? → A: 대기열 + 자동 재시도 (로딩 애니메이션 표시, 사용자 경험 우선)

### Session 2026-02-13 (ANALYZE 단계 해결)

- Q: 비로그인 사용자의 서버 API 처리 방식은? → A: 비로그인 사용자는 AI 채점 전용 API(`POST /api/battle/grade`)만 서버 호출. 프로필/전투세션/히스토리 등 모든 상태는 localStorage에서 관리. 로그인 시 `/api/auth/sync`로 일괄 동기화. 기존 battle API는 인증 필수로 변경.
- Q: AI 채점 점수 구간 정의는? → A: 정답(correct) >= 0.8, 부분정답(partial) 0.3 이상 0.8 미만, 오답(wrong) < 0.3
- Q: 사용자 HP 회복 시점은? → A: 매 전투 시작 시 HP를 max_hp로 리셋
- Q: 오답 시 몬스터 반격 데미지는? → A: 고정 20 HP (MVP), 몬스터 레벨 구간별 차등은 Phase 2에서 도입

## User Scenarios & Testing

### User Story 1 - 캐릭터 생성과 첫 전투 (Priority: P1)

첫 접속 사용자가 로그인 없이 캐릭터를 생성하고 바로 첫 번째 퀴즈(전투)를 플레이한다. 닉네임 입력, 픽셀아트 아바타 선택(3~4종) 후 즉시 몬스터와 전투가 시작된다.

**Why this priority**: 서비스의 핵심 진입점. 사용자가 가장 먼저 경험하는 플로우이며, 이것만으로도 퀴즈 RPG의 가치를 체험할 수 있다.

**Independent Test**: 비로그인 상태에서 캐릭터 생성 → 첫 퀴즈 풀이 → 결과 확인까지의 전체 플로우를 독립적으로 테스트 가능

**Acceptance Scenarios**:

1. **Given** 첫 접속 사용자, **When** 앱 진입, **Then** 로그인 없이 바로 캐릭터 생성 화면 표시
2. **Given** 캐릭터 생성 화면, **When** 닉네임 입력 + 외형 선택 + "모험 시작하기" 탭, **Then** 캐릭터 생성 완료 후 첫 전투 자동 진입
3. **Given** 캐릭터 생성 완료, **When** 데이터 저장, **Then** localStorage에 캐릭터 정보 임시 저장

---

### User Story 2 - 퀴즈 전투 & AI 채점 (Priority: P1)

사용자가 전투 화면에서 몬스터와 퀴즈 전투를 한다. CS 분야별 주관식 문제에 답변을 작성하고 제출하면 AI가 채점하여 정답/부분정답/오답을 판정하고, 그에 따라 몬스터에게 데미지를 주거나 반격당한다.

**Why this priority**: 서비스의 핵심 게임 루프. 모든 기능이 이 전투 시스템 위에 구축된다.

**Independent Test**: 전투 시작 → 문제 출제 → 주관식 답변 입력 → AI 채점 → 데미지/피격 연출 → 해설 확인까지 완전한 1회전 테스트 가능

**Acceptance Scenarios**:

1. **Given** 전투 시작, **When** 몬스터 등장, **Then** 레벨에 맞는 몬스터 + CS 분야 퀴즈 문제 동시 출제
2. **Given** 퀴즈 출제됨, **When** 주관식 답변 작성 후 "공격하기" 탭, **Then** AI 채점 실행 (0.0~1.0 점수)
3. **Given** AI 채점 완료 (정답 score >= 0.8), **When** 결과 표시, **Then** 크리티컬 히트 애니메이션 + 몬스터 HP 대폭 감소 + EXP 획득
4. **Given** AI 채점 완료 (부분정답 0.3~0.7), **When** 결과 표시, **Then** 일반 공격 애니메이션 + 몬스터 HP 일부 감소 + 비례 EXP 획득
5. **Given** AI 채점 완료 (오답 score < 0.3), **When** 결과 표시, **Then** 미스 애니메이션 + 몬스터 반격 (내 HP 감소) + 최소 EXP
6. **Given** 모든 채점 결과, **When** 결과 화면 표시, **Then** AI 해설 + 모범 답안 + 학습 팁 항상 포함
7. **Given** 몬스터 HP가 0, **When** 전투 종료, **Then** 승리 연출 + 보너스 EXP + 처치 기록

---

### User Story 3 - 캐릭터 성장 시스템 (Priority: P1)

퀴즈를 풀면 EXP를 얻고 레벨업한다. 레벨 1~100까지 성장하며, 특정 레벨에서 가장 많이 맞춘 CS 분야 기준으로 자동전직이 발생한다. 연속 정답 콤보 시 보너스 EXP를 획득한다.

**Why this priority**: 게이미피케이션의 핵심. 레벨업/전직이 없으면 단순 퀴즈 앱과 차별점이 없다.

**Independent Test**: 퀴즈 반복 풀이 → EXP 축적 → 레벨업 연출 → 전직 발생까지 성장 시스템 독립 테스트 가능

**Acceptance Scenarios**:

1. **Given** 정답 제출, **When** EXP 계산, **Then** 기본 100 EXP + 콤보 보너스(3연속 1.5배, 5연속 2배, 10연속 3배) 적용
2. **Given** 부분 정답, **When** EXP 계산, **Then** AI 점수에 비례하여 30~70 EXP 부여
3. **Given** 오답, **When** EXP 계산, **Then** 도전 보상 10 EXP 부여, 콤보 리셋
4. **Given** EXP가 레벨업 기준 도달, **When** 레벨업 발생, **Then** 빛기둥 + 코드 파티클 애니메이션 연출 + 새 레벨 표시
5. **Given** 레벨 10/30/50/70/90 도달, **When** 자동전직 조건 확인, **Then** 최고 정답률 분야 기준 직업 변경 + 전직 애니메이션

---

### User Story 4 - 비로그인 플레이 & 로그인 동기화 (Priority: P2)

비로그인 상태에서 localStorage로 플레이하다가, 레벨 5 도달 시 로그인 유도 팝업이 나타난다. Google OAuth 로그인 시 localStorage 데이터가 Supabase로 자동 동기화된다. 강제 로그인은 절대 없다.

**Why this priority**: 사용자 리텐션의 핵심. 데이터 영속성 없이는 장기 이용 불가능하나, 핵심 게임 루프(P1) 이후에 필요.

**Independent Test**: 비로그인으로 레벨 5까지 플레이 → 로그인 팝업 확인 → Google 로그인 → 데이터 동기화 확인

**Acceptance Scenarios**:

1. **Given** 비로그인 상태, **When** 퀴즈 플레이, **Then** 모든 데이터 localStorage에 저장, 정상 플레이 가능
2. **Given** 레벨 5 도달, **When** 레벨업, **Then** "데이터를 잃지 않으려면 로그인하세요" 팝업 1회 표시 (닫기 가능)
3. **Given** 로그인 팝업, **When** Google OAuth 로그인 완료, **Then** localStorage 데이터 → Supabase 자동 동기화
4. **Given** 비로그인 상태, **When** 메뉴에서 "로그인" 버튼 탭, **Then** 언제든 자발적 로그인 가능
5. **Given** 비로그인 상태, **When** 어떤 기능이든 접근, **Then** 강제 로그인 차단 없음

---

### User Story 5 - 풀이 히스토리 & 오답 노트 (Priority: P2)

사용자가 모든 퀴즈 풀이 기록을 타임라인으로 확인하고, 분야별 필터링, 오답 모아보기로 복습한다. 분야별 정답률 통계와 평균 점수도 확인 가능하다.

**Why this priority**: 학습 효과 극대화에 필수적인 복습 기능이지만, 핵심 게임 루프 이후에 의미가 있다.

**Independent Test**: 퀴즈 여러 문제 풀이 후 → 히스토리 타임라인 확인 → 분야별 필터 → 오답 노트 → 통계 확인

**Acceptance Scenarios**:

1. **Given** 풀이 기록 존재, **When** 히스토리 화면 진입, **Then** 날짜별 타임라인 스크롤로 전체 기록 표시 (문제, 내 답변, AI 채점, 모범 답안, 소요 시간)
2. **Given** 히스토리 화면, **When** 분야별 필터 선택, **Then** 해당 분야 기록만 필터링
3. **Given** 히스토리 화면, **When** "오답 노트" 탭, **Then** 오답 + 부분 정답만 모아보기
4. **Given** 히스토리 화면, **When** 통계 탭, **Then** 분야별 정답률, 총 문제 수, 평균 점수 표시

---

### User Story 6 - 후원 & 아이템샵 (Priority: P3)

사용자가 API 비용 후원을 위해 젬을 충전(토스페이먼츠)하고, 젬으로 캐릭터 코스튬 아이템을 구매한다. 모든 아이템은 외형만 변경하며, 게임 능력치에 영향 없다. 후원 경험에 따라 뱃지가 부여된다.

**Why this priority**: 서비스 지속성(수익)을 위해 필요하지만, 핵심 게임 플레이와 독립적.

**Independent Test**: 젬 충전 → 아이템샵 탐색 → 아이템 구매 → 장착 → 캐릭터 외형 변경 확인

**Acceptance Scenarios**:

1. **Given** 로그인된 사용자, **When** 후원하기 진입, **Then** 젬 충전 옵션 표시 (1,000원/3,000원/5,000원/10,000원 + 보너스)
2. **Given** 충전 금액 선택, **When** 토스페이먼츠 결제 완료, **Then** 젬 잔고에 즉시 반영 (보너스 포함)
3. **Given** 젬 보유, **When** 아이템샵에서 코스튬 선택 + 구매, **Then** 젬 차감 + 인벤토리에 아이템 추가
4. **Given** 아이템 보유, **When** 장착/해제 토글, **Then** 캐릭터 외형에 즉시 반영
5. **Given** 후원 경험 존재, **When** 프로필 확인, **Then** 누적 금액별 뱃지 표시 (브론즈 1,000원+/실버 10,000원+/골드 50,000원+)
6. **Given** 비로그인 사용자, **When** 후원 시도, **Then** Google 로그인 유도 (결제 전 필수)

---

### User Story 7 - 캐릭터 자랑하기 & 공개 프로필 (Priority: P3)

캐릭터 카드 이미지(트레이딩 카드 스타일)를 자동 생성하고, 공개 프로필 페이지(/profile/[nickname])를 통해 SNS 공유한다. OG 메타태그로 카카오톡/슬랙 등에서 카드 미리보기가 노출된다.

**Why this priority**: 바이럴 성장을 위한 핵심 기능이나, 핵심 게임 플레이 + 계정 시스템이 먼저 갖춰져야 한다.

**Independent Test**: 프로필 → 자랑하기 버튼 → 카드 이미지 확인 → 링크 복사 → 공개 프로필 페이지 접근 → OG 이미지 확인

**Acceptance Scenarios**:

1. **Given** 캐릭터 데이터 존재, **When** 서버에서 캐릭터 카드 요청, **Then** 트레이딩 카드 스타일 이미지 동적 생성 (닉네임, 레벨, 직업, 정답률, 칭호, 뱃지 포함)
2. **Given** 프로필 화면, **When** "자랑하기" 버튼 탭, **Then** 링크 복사 / 이미지 저장 / 네이티브 공유 옵션 제공
3. **Given** 공개 프로필 URL, **When** 비로그인 사용자가 접근, **Then** 캐릭터 정보 + 분야별 레이더 차트 표시
4. **Given** 공개 프로필 URL, **When** SNS에 링크 붙여넣기, **Then** OG 메타태그로 캐릭터 카드 이미지 미리보기 표시
5. **Given** 첫 공유 행위, **When** 공유 완료, **Then** +50 EXP 보너스 + "소셜 모험가" 칭호 해금

---

### Edge Cases

- **AI 채점 서비스 장애 시**: 사용자에게 "채점 서비스 일시 장애" 안내 + 재시도 옵션 제공. 답변은 임시 저장하여 복구 후 채점
- **localStorage 용량 초과 시**: 가장 오래된 세션 데이터부터 정리 + 로그인 유도
- **동시 세션 충돌**: 같은 계정이 여러 기기에서 로그인 시 최신 세션 우선, 이전 세션에 알림
- **결제 도중 앱 이탈**: 토스페이먼츠 결제 상태 서버에서 확인 + 미완료 결제 자동 취소
- **닉네임 중복**: 닉네임 고유성 검증 + 중복 시 대안 제안
- **빈 답변 제출**: 빈 답변은 제출 불가 (버튼 비활성화)
- **내 HP 0 도달**: 전투 실패 처리 → "재도전" 또는 "다른 몬스터" 선택지 제공, 캐릭터 사망 없음
- **문제 은행 소진**: 같은 레벨 구간에서 모든 문제를 푼 경우 이전에 틀린 문제 재출제
- **연속 오답 시**: 난이도 낮은 문제 제안 (사용자 의욕 저하 방지)
- **네트워크 끊김 (비로그인)**: localStorage 데이터 보존, 재접속 시 이어서 플레이
- **환불 요청**: 미사용 젬에 한해 7일 이내 환불, 사용된 젬은 환불 불가

## Requirements

### Functional Requirements

- **FR-001**: 시스템 MUST 로그인 없이 캐릭터 생성(닉네임 + 외형 3~4종 선택) 허용
- **FR-002**: 시스템 MUST 비로그인 데이터를 localStorage에 저장하고, 로그인 시 Supabase로 자동 동기화
- **FR-003**: 시스템 MUST 레벨에 맞는 CS 분야 퀴즈를 주관식으로 출제 (8개 분야: 네트워크, Linux/OS, DB, 배포/CI-CD, 모니터링, 보안, 아키텍처, 장애/SRE)
- **FR-004**: 시스템 MUST AI(Gemini)를 통해 주관식 답변을 0.0~1.0 점수로 채점하고, 피드백 + 모범 답안 + 팁을 제공
- **FR-005**: 시스템 MUST 채점 결과에 따라 전투 애니메이션 표시 (정답 score>=0.8 크리티컬/부분정답 0.3<=score<0.8 일반 공격/오답 score<0.3 미스+반격)
- **FR-006**: 시스템 MUST EXP 시스템 운영 (정답 100EXP, 부분정답 30~70EXP, 오답 10EXP, 콤보 보너스 1.5x/2x/3x)
- **FR-007**: 시스템 MUST 레벨 1~100 성장 시스템 운영 (6단계 구간: 수습→견습→정식→베테랑→마스터→전설)
- **FR-008**: 시스템 MUST 레벨 10/30/50/70/90에서 최고 정답률 분야 기준 자동전직 (8개 직업)
- **FR-009**: 시스템 MUST 몬스터 HP 시스템 운영 (1마리 = 3~5문제, 처치 시 보너스 EXP)
- **FR-010**: 시스템 MUST 사용자 HP 시스템 운영 (오답 시 고정 20 HP 감소, 전투 시작 시 max_hp로 리셋, 0이면 전투 실패 → 재도전/다른 몬스터)
- **FR-011**: 시스템 MUST Google OAuth 인증 지원 (Supabase Auth)
- **FR-012**: 시스템 MUST 레벨 5 도달 시 로그인 유도 팝업 1회 표시 (닫기 가능, 강제 아님)
- **FR-013**: 시스템 MUST 모든 퀴즈 풀이 기록 저장 (문제, 답변, 점수, 피드백, 모범 답안, 소요 시간)
- **FR-014**: 시스템 MUST 히스토리 타임라인 뷰 + 분야별 필터 + 오답 노트 + 통계 제공
- **FR-015**: 시스템 MUST 토스페이먼츠 결제로 젬 충전 (1,000원~10,000원 + 보너스)
- **FR-016**: 시스템 MUST 아이템샵에서 코스튬 아이템만 판매 (모자/무기스킨/의상/이펙트/펫/칭호프레임)
- **FR-017**: 시스템 MUST 아이템 장착/해제 시 캐릭터 외형에 반영 (능력치 영향 없음)
- **FR-018**: 시스템 MUST 후원 누적 금액별 뱃지 부여 (브론즈 1,000원+/실버 10,000원+/골드 50,000원+)
- **FR-019**: 시스템 MUST 캐릭터 카드 이미지를 서버에서 동적 생성 (ImageResponse)
- **FR-020**: 시스템 MUST 공개 프로필 페이지 제공 (/profile/[nickname], 비로그인 열람 가능)
- **FR-021**: 시스템 MUST OG 메타태그에 캐릭터 카드 이미지 삽입하여 SNS 미리보기 지원
- **FR-022**: 시스템 MUST 공유 기능 제공 (링크 복사, 이미지 저장, Web Share API)
- **FR-023**: 시스템 MUST 모바일 중심 UI (max-width 430px, 하단 중심 인터랙션)
- **FR-024**: 시스템 MUST 2D 픽셀아트 스타일 UI + 메이플 감성 (독자 디자인)

### Key Entities

- **Profile**: 사용자의 게임 캐릭터 정보 (닉네임, 레벨, EXP, HP, 직업, 외형, 젬 잔고, 후원 뱃지)
- **Question**: CS 퀴즈 문제 (분야, 세부주제, 난이도, 문제 텍스트, 모범 답안, 키워드, 해설)
- **Monster**: 전투 몬스터 (이름, 레벨 구간, HP, 이미지, 관련 CS 분야)
- **QuizHistory**: 풀이 기록 (사용자, 문제, 답변, 채점 결과, EXP, 소요 시간, 콤보)
- **BattleSession**: 전투 세션 (사용자, 몬스터, 남은 HP, 상태, 문제 수)
- **ShopItem**: 코스튬 아이템 (이름, 카테고리, 가격, 이미지, 등급)
- **UserItem**: 사용자 보유/장착 아이템
- **Donation**: 후원 내역 (금액, 젬, 결제 상태)

## Success Criteria

### Measurable Outcomes

- **SC-001**: 사용자가 첫 접속에서 캐릭터 생성 + 첫 퀴즈 완료까지 2분 이내에 도달
- **SC-002**: 유저당 일일 평균 10문제 이상 풀이
- **SC-003**: AI 채점 응답 시간 3초 이내 (답변 제출 ~ 결과 표시)
- **SC-004**: 7일 재방문율 30% 이상
- **SC-005**: 평균 세션 시간 10분 이상
- **SC-006**: 레벨 10 도달률: 첫 접속 유저 중 50% 이상
- **SC-007**: Google 로그인 전환율: 레벨 5 도달 유저 중 40% 이상
- **SC-008**: 모든 전투/채점 인터랙션에서 애니메이션 프레임 드롭 없이 60fps 유지 (모바일 기준)
- **SC-009**: 결제 성공률 95% 이상 (토스페이먼츠)

## Non-Functional Requirements

- **NFR-001**: 시스템은 100명 이하 동시 접속을 안정적으로 처리해야 한다 (MVP 기준)
- **NFR-002**: AI 채점 API rate limit 도달 시 대기열 + 자동 재시도 전략 적용 (로딩 애니메이션 표시)
- **NFR-003**: 모든 페이지 초기 로드 3초 이내 (모바일 4G 환경)
- **NFR-004**: AI 채점 응답 3초 이내 (정상 상태)
- **NFR-005**: 결제 데이터는 서버 사이드에서만 처리, 클라이언트에 비밀키 노출 금지

## Assumptions

- 초기 문제 은행은 8개 분야 x 최소 50문제 = 400문제 이상으로 구축
- 몬스터/캐릭터 픽셀아트 이미지는 AI 생성 후 Supabase Storage에 사전 업로드
- Gemini 3 Flash Preview 모델이 한국어 주관식 채점에 충분한 정확도 제공
- 토스페이먼츠 일반결제(카드/토스페이/간편결제) 사용
- 메이플스토리 저작권 회피를 위해 독자 디자인 사용 (3등신 픽셀 캐릭터, IT 테마 몬스터)
- Phase 1 MVP에 일일 퀘스트, 칭호/업적, 몬스터 도감, 주간 리포트는 미포함
